app-id: @APP_ID@
runtime: org.freedesktop.Platform
runtime-version: "@RUNTIME_VERSION@"
sdk: org.freedesktop.Sdk

base-app: org.mozilla.firefox.BaseApp
base-app-version: "@RUNTIME_VERSION@"

command: firefox

finish-args:
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --device=dri
  - --persist=.mozilla
  - --env=MOZ_ENABLE_WAYLAND=1
  - --own-name=org.mozilla.firefox.*

modules:
  - name: firefox-nightly
    buildsystem: simple
    build-commands:
      - install -d /app/lib/firefox
      - tar -xf firefox.tar.xz -C /app/lib/firefox --strip-components=1

      - install -d /app/bin
      - ln -s /app/lib/firefox/firefox /app/bin/firefox

      - install -Dm0644 @APP_ID@.desktop /app/share/applications/@APP_ID@.desktop
      - install -Dm0644 @APP_ID@.appdata.xml /app/share/metainfo/@APP_ID@.metainfo.xml

      - |
        for s in 16 32 48 64 128; do \
          install -Dm0644 \
            /app/lib/firefox/browser/chrome/icons/default/default${s}.png \
            /app/share/icons/hicolor/${s}x${s}/apps/@APP_ID@.png; \
        done

      - install -Dm0644 policies.json /app/lib/firefox/distribution/policies.json

    sources:
      - type: file
        path: firefox.tar.xz

      - type: file
        path: @APP_ID@.desktop

      - type: file
        path: @APP_ID@.appdata.xml

      - type: file
        path: policies.json